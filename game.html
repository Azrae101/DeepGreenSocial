<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Trash Sorting Game - DK Version</title>
<style>
    body {
        margin: 0;
        padding: 0;
        background: #eef2f3;
        font-family: Arial, sans-serif;
    }

    h1 {
        text-align: center;
        padding: 20px;
        color: #2e7d32;
    }

    .game-container {
        width: 90%;
        max-width: 900px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        position: relative;
    }

    #gameArea {
        position: relative;
        height: 500px;
        background: #dff5e1;
        border: 3px solid #2e7d32;
        border-radius: 10px;
        overflow: hidden;
    }

    /* Placeholder item styling */
    .falling-item {
        position: absolute;
        width: 70px;
        height: 70px;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        user-select: none;
        cursor: grab;
        transition: transform 0.2s;
    }

    .falling-item.dragging {
        transform: scale(1.1);
        z-index: 100;
    }

    .bins {
        position: absolute;
        bottom: 0;
        width: 100%;
        display: flex;
        justify-content: space-around;
        padding: 10px 0;
    }

    .bin {
        width: 140px;
        height: 150px;
        border-radius: 10px 10px 0 0;
        text-align: center;
        font-weight: bold;
        color: white;
        display: flex;
        justify-content: center;
        align-items: flex-end;
        padding-bottom: 10px;
        font-size: 14px;
        transition: transform 0.2s;
    }

    .bin.highlight {
        transform: scale(1.05);
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
    }

    /* Danish waste sorting colors */
    .bin-recycle { background: #0072bc; }     /* Blue – papir/pap */
    .bin-food { background: #7a5901; }        /* Brown – madaffald */
    .bin-rest { background: #1b1b1b; }        /* Black – restaffald */

    #stats {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 18px;
    }

    #startBtn {
        background-color: #4CAF50;
        color: white;
        padding: 12px 26px;
        font-size: 1.2rem;
        font-weight: 600;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: 0.12s ease;
        margin-bottom: 15px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    #startBtn:hover {
        background-color: #45a049;
        transform: translateY(-2px);
    }

    #startBtn:active {
        background-color: #3d8b40;
        transform: scale(0.97);
    }

    /* Game Over Modal */
    #gameOverModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background-color: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
        max-width: 500px;
        width: 90%;
        animation: modalAppear 0.3s ease-out;
    }

    @keyframes modalAppear {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    .modal-content h2 {
        color: #d32f2f;
        margin-top: 0;
        font-size: 2.2rem;
    }

    .modal-content p {
        font-size: 1.2rem;
        margin: 15px 0;
    }

    .score-display {
        font-size: 2.5rem;
        font-weight: bold;
        color: #2e7d32;
        margin: 20px 0;
    }

    .new-highscore {
        color: #ff9800;
        font-weight: bold;
        font-size: 1.3rem;
        animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    #modalRestartBtn {
        background-color: #ff9800;
        color: white;
        padding: 12px 30px;
        font-size: 1.2rem;
        font-weight: 600;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: 0.12s ease;
        margin-top: 20px;
    }

    #modalRestartBtn:hover {
        background-color: #e68900;
        transform: translateY(-2px);
    }

    #modalRestartBtn:active {
        background-color: #d17a00;
        transform: scale(0.97);
    }

    .feedback {
        position: absolute;
        font-size: 1.5rem;
        font-weight: bold;
        pointer-events: none;
        z-index: 50;
        animation: floatUp 1s ease-out forwards;
    }

    @keyframes floatUp {
        0% { transform: translateY(0); opacity: 1; }
        100% { transform: translateY(-50px); opacity: 0; }
    }

    .correct {
        color: #4CAF50;
    }

    .incorrect {
        color: #f44336;
    }
</style>
</head>
<body>
<h1>Trash Sorting Game</h1>

<div class="game-container">
    <div id="stats">
        <div>Score: <span id="score">0</span></div>
        <div>Lives: <span id="lives">5</span></div>
        <div>High Score: <span id="highScore">0</span></div>
    </div>

    <button id="startBtn">Start Game</button>

    <div id="gameArea">
        <div class="bins">
            <div class="bin bin-recycle" data-type="recycling">Genbrug</div>
            <div class="bin bin-food" data-type="compost">Madaffald</div>
            <div class="bin bin-rest" data-type="trash">Rest</div>
        </div>
    </div>
</div>

<!-- Game Over Modal -->
<div id="gameOverModal">
    <div class="modal-content">
        <h2>Game Over!</h2>
        <p>Your final score:</p>
        <div class="score-display" id="finalScore">0</div>
        <div id="highScoreMessage"></div>
        <button id="modalRestartBtn">Play Again</button>
    </div>
</div>

<script>
let gameActive = false;
let score = 0;
let highScore = localStorage.getItem('trashSortingHighScore') || 0;
let lives = 5;
let items = [];
let itemInterval;
let gameSpeed = 2500; // Slower initial speed
const minSpeed = 800; // Minimum speed
let speedIncreaseCounter = 0;

const gameArea = document.getElementById('gameArea');
const currentScoreEl = document.getElementById('score');
const livesEl = document.getElementById('lives');
const highScoreEl = document.getElementById('highScore');
const startBtn = document.getElementById('startBtn');
const gameOverModal = document.getElementById('gameOverModal');
const finalScoreEl = document.getElementById('finalScore');
const highScoreMessageEl = document.getElementById('highScoreMessage');
const modalRestartBtn = document.getElementById('modalRestartBtn');
const bins = document.querySelectorAll('.bin');

highScoreEl.textContent = highScore;

// --- ITEM DEFINITIONS ---
const itemTypes = [
    { type: 'plastic', correctBin: 'recycling', color: '#2196f3' },
    { type: 'food', correctBin: 'compost', color: '#795548' },
    { type: 'trash', correctBin: 'trash', color: '#424242' }
];

// --- START GAME ---
function startGame() {
    if (gameActive) return;

    gameActive = true;
    score = 0;
    lives = 5;
    gameSpeed = 2500; // Reset to slower speed
    speedIncreaseCounter = 0;

    currentScoreEl.textContent = score;
    livesEl.textContent = lives;
    startBtn.textContent = 'Restart Game';
    gameOverModal.style.display = 'none';

    // Clear any existing items
    document.querySelectorAll('.falling-item').forEach(i => i.remove());

    // Clear any existing intervals
    clearInterval(itemInterval);
    
    // Start creating items
    itemInterval = setInterval(createItem, gameSpeed);
}

// --- CREATE FALLING ITEM ---
function createItem() {
    if (!gameActive) return;

    const type = itemTypes[Math.floor(Math.random() * itemTypes.length)];
    const item = document.createElement('div');

    item.className = 'falling-item';
    item.dataset.type = type.type;
    item.dataset.correctBin = type.correctBin;
    item.style.backgroundColor = type.color;

    // Placeholder text
    item.textContent = type.type.toUpperCase();
    item.style.color = 'white';
    item.style.fontWeight = 'bold';
    item.style.fontSize = '12px';
    item.style.display = 'flex';
    item.style.alignItems = 'center';
    item.style.justifyContent = 'center';

    // Position
    const left = Math.random() * (gameArea.offsetWidth - 60);
    item.style.left = `${left}px`;
    item.style.top = `0px`;

    // DRAGGING
    item.draggable = true;
    const uniqueId = 'item_' + Date.now() + Math.random().toString(36).substr(2, 5);
    item.id = uniqueId;
    
    item.addEventListener('dragstart', e => {
        e.dataTransfer.setData('itemId', uniqueId);
        item.classList.add('dragging');
        // Set drag image to the element itself
        e.dataTransfer.setDragImage(item, 35, 35);
    });
    
    item.addEventListener('dragend', e => {
        item.classList.remove('dragging');
        // If the drag ends without a drop, the item remains
    });

    gameArea.appendChild(item);

    // FALLING
    let fallSpeed = 1; // Slower initial fall speed
    item.fallInterval = setInterval(() => {
        if (!gameActive) return;

        let top = parseInt(item.style.top);
        top += fallSpeed;
        item.style.top = `${top}px`;

        // Hit ground
        if (top >= gameArea.offsetHeight - 160) {
            clearInterval(item.fallInterval);
            item.remove();
            loseLife();
        }
    }, 30); // Slower update interval
}

// --- DROP SYSTEM ---
bins.forEach(bin => {
    bin.addEventListener('dragover', e => {
        e.preventDefault();
        bin.classList.add('highlight');
    });
    
    bin.addEventListener('dragleave', e => {
        bin.classList.remove('highlight');
    });

    bin.addEventListener('drop', e => {
        e.preventDefault();
        bin.classList.remove('highlight');
        
        const id = e.dataTransfer.getData('itemId');
        const item = document.getElementById(id);

        if (!item) return;

        const correct = item.dataset.correctBin;
        const dropped = bin.dataset.type;

        // Create feedback element
        const feedback = document.createElement('div');
        feedback.className = 'feedback';
        
        if (correct === dropped) {
            // Correct
            score += 1;
            currentScoreEl.textContent = score;
            
            feedback.textContent = '+1';
            feedback.classList.add('correct');
            
            // Gradually increase difficulty
            speedIncreaseCounter++;
            if (speedIncreaseCounter % 5 === 0 && gameSpeed > minSpeed) {
                gameSpeed -= 50;
                clearInterval(itemInterval);
                itemInterval = setInterval(createItem, gameSpeed);
            }

            if (score > highScore) {
                highScore = score;
                highScoreEl.textContent = highScore;
                localStorage.setItem('trashSortingHighScore', highScore);
            }
        } else {
            // Wrong
            loseLife();
            feedback.textContent = '-1 Life';
            feedback.classList.add('incorrect');
        }
        
        // Position and show feedback
        feedback.style.left = (e.clientX - gameArea.getBoundingClientRect().left - 30) + 'px';
        feedback.style.top = (e.clientY - gameArea.getBoundingClientRect().top - 20) + 'px';
        gameArea.appendChild(feedback);
        
        // Remove feedback after animation
        setTimeout(() => {
            feedback.remove();
        }, 1000);

        // Remove the dragged item
        clearInterval(item.fallInterval);
        item.remove();
    });
});

// --- LOSE LIFE ---
function loseLife() {
    lives--;
    livesEl.textContent = lives;

    if (lives <= 0) {
        endGame();
    }
}

// --- END GAME ---
function endGame() {
    gameActive = false;
    clearInterval(itemInterval);

    document.querySelectorAll('.falling-item').forEach(item => {
        clearInterval(item.fallInterval);
        item.remove();
    });

    // SAVE USER GAME POINTS
    const currentUser = JSON.parse(localStorage.getItem('sustainalearn_currentUser'));
    if (currentUser) {
        const users = JSON.parse(localStorage.getItem('sustainalearn_users')) || [];
        const i = users.findIndex(u => u.username === currentUser.username);

        if (i !== -1) {
            users[i].gamePoints = (users[i].gamePoints || 0) + score;

            localStorage.setItem('sustainalearn_users', JSON.stringify(users));
            localStorage.setItem('sustainalearn_currentUser', JSON.stringify(users[i]));
        }
    }

    // Show game over modal
    finalScoreEl.textContent = score;
    
    if (score > highScore) {
        highScoreMessageEl.textContent = "New High Score!";
        highScoreMessageEl.className = "new-highscore";
    } else {
        highScoreMessageEl.textContent = `High Score: ${highScore}`;
        highScoreMessageEl.className = "";
    }
    
    gameOverModal.style.display = 'flex';
}

startBtn.addEventListener('click', startGame);
modalRestartBtn.addEventListener('click', startGame);
</script>
</body>
</html>